{"version":3,"file":"index.js","sources":["../../../../../node_modules/@typhonjs-svelte/runtime-base/_dist/svelte/store/dom/input/index.js"],"sourcesContent":["import { isIterable } from '@typhonjs-svelte/runtime-base/util/object';\n\n/**\n * Provides a readable store to track keys actively pressed. KeyStore is designed to be used with the\n * {@link keyforward} action.\n */\nclass KeyStore\n{\n   #keySet;\n\n   /**\n    * @type {Map<string, number>}\n    */\n   #keyMap = new Map();\n\n   /**\n    * @type {KeyStoreOptions}\n    */\n   #options = { preventDefault: true, useCode: true, stopPropagation: true };\n\n   /**\n    * Stores the subscribers.\n    *\n    * @type {import('svelte/store').Subscriber<KeyStore>[]}\n    */\n   #subscriptions = [];\n\n   /**\n    * @param {Iterable<string>}  [keyNames] -\n    *\n    * @param {KeyStoreOptions}   [options] - Optional parameters\n    */\n   constructor(keyNames, options)\n   {\n      if (!isIterable(keyNames))\n      {\n         throw new TypeError(`'keyNames' is not an iterable list.`);\n      }\n\n      this.setOptions(options);\n\n      this.#keySet = new Set(keyNames);\n   }\n\n   /**\n    * Add given key to the tracking key set.\n    *\n    * @param {string}   key - Key to add.\n    */\n   addKey(key)\n   {\n      if (typeof key !== 'string') { throw new TypeError(`'key' is not a string.`); }\n\n      this.#keySet.add(key);\n   }\n\n   /**\n    * @returns {boolean} True if any keys in the key set are pressed.\n    */\n\n   /**\n    * Returns true if any of given keys are pressed. If `keys` is undefined then the result is true if any keys being\n    * tracked are pressed.\n    *\n    * @param {string | Iterable<string>} [keys] - Zero or more key strings or list to verify if any pressed.\n    *\n    * @returns {boolean} True if any keys set are pressed.\n    */\n   anyPressed(keys)\n   {\n      // When no keys given then check if any key is pressed.\n      if (keys === void 0) { return this.#keyMap.size > 0; }\n\n      const isList = isIterable(keys);\n\n      if (typeof keys !== 'string' && !isList)\n      {\n         throw new TypeError(`'keys' is not a string or iterable list of strings.`);\n      }\n\n      let result = false;\n\n      if (isList)\n      {\n         for (const key of keys)\n         {\n            if (this.#keyMap.has(key))\n            {\n               result = true;\n               break;\n            }\n         }\n      }\n      else\n      {\n         if (this.#keyMap.has(keys)) { result = true; }\n      }\n\n      return result;\n   }\n\n   /**\n    * Is the given key in the tracking key set.\n    *\n    * @param {string}   key - Key to check.\n    */\n   hasKey(key)\n   {\n      if (typeof key !== 'string') { throw new TypeError(`'key' is not a string.`); }\n\n      this.#keySet.has(key);\n   }\n\n   /**\n    * Returns true if all given keys are pressed.\n    *\n    * @param {string|Iterable<string>} keys - One or more key strings to verify if pressed.\n    *\n    * @returns {boolean} Are all keys pressed.\n    */\n   isPressed(keys)\n   {\n      const isList = isIterable(keys);\n\n      if (typeof keys !== 'string' && !isList)\n      {\n         throw new TypeError(`'keys' is not a string or iterable list of strings.`);\n      }\n\n      let result = true;\n\n      if (isList)\n      {\n         for (const key of keys)\n         {\n            if (!this.#keyMap.has(key))\n            {\n               result = false;\n               break;\n            }\n         }\n      }\n      else\n      {\n         if (!this.#keyMap.has(keys)) { result = false; }\n      }\n\n      return result;\n   }\n\n   /**\n    * Handle keydown event adding any key from the tracked key set.\n    *\n    * @param {KeyboardEvent}  event - KeyboardEvent.\n    */\n   keydown(event)\n   {\n      const key = this.#options.useCode ? event.code : event.key;\n\n      if (this.#keySet.has(key))\n      {\n         if (!this.#keyMap.has(key))\n         {\n            this.#keyMap.set(key, 1);\n            this._updateSubscribers();\n         }\n\n         if (this.#options.preventDefault) { event.preventDefault(); }\n         if (this.#options.stopPropagation) { event.stopPropagation(); }\n      }\n   }\n\n   /**\n    * @returns {IterableIterator<string>} Returns current pressed keys iterator.\n    */\n   keysPressed()\n   {\n      return this.#keyMap.keys();\n   }\n\n   /**\n    * @returns {IterableIterator<string>} Returns currently tracked keys iterator.\n    */\n   keysTracked()\n   {\n      return this.#keySet.keys();\n   }\n\n   /**\n    * Handle keyup event removing any key from the tracked key set.\n    *\n    * @param {KeyboardEvent}  event - KeyboardEvent.\n    */\n   keyup(event)\n   {\n      const key = this.#options.useCode ? event.code : event.key;\n\n      if (this.#keySet.has(key))\n      {\n         if (this.#keyMap.has(key))\n         {\n            this.#keyMap.delete(key);\n            this._updateSubscribers();\n         }\n\n         if (this.#options.preventDefault) { event.preventDefault(); }\n         if (this.#options.stopPropagation) { event.stopPropagation(); }\n      }\n   }\n\n   /**\n    * Remove the given key from the tracking key set.\n    *\n    * @param {string}   key - Key to remove.\n    */\n   removeKey(key)\n   {\n      if (typeof key !== 'string') { throw new TypeError(`'key' is not a string.`); }\n\n      if (this.#keySet.has(key))\n      {\n         this.#keySet.delete(key);\n\n         if (this.#keyMap.has(key))\n         {\n            this.#keyMap.delete(key);\n            this._updateSubscribers();\n         }\n      }\n   }\n\n   /**\n    * Update options.\n    *\n    * @param {KeyStoreOptions}   options - Options to set.\n    */\n   setOptions(options)\n   {\n      if (typeof options?.preventDefault === 'boolean') { this.#options.preventDefault = options.preventDefault; }\n      if (typeof options?.useCode === 'boolean') { this.#options.useCode = options.useCode; }\n      if (typeof options?.stopPropagation === 'boolean') { this.#options.stopPropagation = options.stopPropagation; }\n   }\n\n   /**\n    * @param {string}   key - key or key code to lookup.\n    *\n    * @returns {number} 1 if currently pressed and 0 if not pressed.\n    */\n   value(key)\n   {\n      return this.#keyMap.has(key) ? 1 : 0;\n   }\n\n   // Store subscriber implementation --------------------------------------------------------------------------------\n\n   /**\n    * @param {import('svelte/store').Subscriber<KeyStore>} handler - Callback function that is invoked on update /\n    *        changes.\n    *\n    * @returns {import('svelte/store').Unsubscriber} Unsubscribe function.\n    */\n   subscribe(handler)\n   {\n      this.#subscriptions.push(handler); // add handler to the array of subscribers\n\n      handler(this);                     // call handler with current value\n\n      // Return unsubscribe function.\n      return () =>\n      {\n         const index = this.#subscriptions.findIndex((sub) => sub === handler);\n         if (index >= 0) { this.#subscriptions.splice(index, 1); }\n      };\n   }\n\n   /**\n    * Updates subscribers.\n    *\n    * @protected\n    */\n   _updateSubscribers()\n   {\n      for (let cntr = 0; cntr < this.#subscriptions.length; cntr++) { this.#subscriptions[cntr](this); }\n   }\n}\n\n/**\n * @typedef {object} KeyStoreOptions\n *\n * @property {boolean}  [preventDefault=true] Invoke `preventDefault` on key events.\n *\n * @property {boolean}  [useCode=true] When true use `event.code` otherwise use `event.key` to get active key.\n *\n * @property {boolean}  [stopPropagation=true] Invoke `stopPropagation` on key events.\n */\n\nexport { KeyStore };\n//# sourceMappingURL=index.js.map\n"],"names":[],"mappings":";;AAEA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,GAAG,OAAO;;AAEV;AACA;AACA;AACA,GAAG,OAAO,GAAG,IAAI,GAAG,EAAE;;AAEtB;AACA;AACA;AACA,GAAG,QAAQ,GAAG,EAAE,cAAc,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,eAAe,EAAE,IAAI,EAAE;;AAE5E;AACA;AACA;AACA;AACA;AACA,GAAG,cAAc,GAAG,EAAE;;AAEtB;AACA;AACA;AACA;AACA;AACA,GAAG,WAAW,CAAC,QAAQ,EAAE,OAAO;AAChC,GAAG;AACH,MAAM,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC;AAC/B,MAAM;AACN,SAAS,MAAM,IAAI,SAAS,CAAC,CAAC,mCAAmC,CAAC,CAAC;AACnE;;AAEA,MAAM,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;;AAE9B,MAAM,IAAI,CAAC,OAAO,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC;AACtC;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,MAAM,CAAC,GAAG;AACb,GAAG;AACH,MAAM,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC;;AAEnF,MAAM,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AAC3B;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,UAAU,CAAC,IAAI;AAClB,GAAG;AACH;AACA,MAAM,IAAI,IAAI,KAAK,MAAM,EAAE,EAAE,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,CAAC,CAAC;;AAE1D,MAAM,MAAM,MAAM,GAAG,UAAU,CAAC,IAAI,CAAC;;AAErC,MAAM,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,CAAC,MAAM;AAC7C,MAAM;AACN,SAAS,MAAM,IAAI,SAAS,CAAC,CAAC,mDAAmD,CAAC,CAAC;AACnF;;AAEA,MAAM,IAAI,MAAM,GAAG,KAAK;;AAExB,MAAM,IAAI,MAAM;AAChB,MAAM;AACN,SAAS,KAAK,MAAM,GAAG,IAAI,IAAI;AAC/B,SAAS;AACT,YAAY,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AACrC,YAAY;AACZ,eAAe,MAAM,GAAG,IAAI;AAC5B,eAAe;AACf;AACA;AACA;AACA;AACA,MAAM;AACN,SAAS,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,GAAG,IAAI,CAAC;AACrD;;AAEA,MAAM,OAAO,MAAM;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,MAAM,CAAC,GAAG;AACb,GAAG;AACH,MAAM,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC;;AAEnF,MAAM,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AAC3B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,SAAS,CAAC,IAAI;AACjB,GAAG;AACH,MAAM,MAAM,MAAM,GAAG,UAAU,CAAC,IAAI,CAAC;;AAErC,MAAM,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,CAAC,MAAM;AAC7C,MAAM;AACN,SAAS,MAAM,IAAI,SAAS,CAAC,CAAC,mDAAmD,CAAC,CAAC;AACnF;;AAEA,MAAM,IAAI,MAAM,GAAG,IAAI;;AAEvB,MAAM,IAAI,MAAM;AAChB,MAAM;AACN,SAAS,KAAK,MAAM,GAAG,IAAI,IAAI;AAC/B,SAAS;AACT,YAAY,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AACtC,YAAY;AACZ,eAAe,MAAM,GAAG,KAAK;AAC7B,eAAe;AACf;AACA;AACA;AACA;AACA,MAAM;AACN,SAAS,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,GAAG,KAAK,CAAC;AACvD;;AAEA,MAAM,OAAO,MAAM;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,OAAO,CAAC,KAAK;AAChB,GAAG;AACH,MAAM,MAAM,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,GAAG;;AAEhE,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AAC/B,MAAM;AACN,SAAS,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AACnC,SAAS;AACT,YAAY,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,CAAC;AACpC,YAAY,IAAI,CAAC,kBAAkB,EAAE;AACrC;;AAEA,SAAS,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,EAAE,KAAK,CAAC,cAAc,EAAE,CAAC;AACpE,SAAS,IAAI,IAAI,CAAC,QAAQ,CAAC,eAAe,EAAE,EAAE,KAAK,CAAC,eAAe,EAAE,CAAC;AACtE;AACA;;AAEA;AACA;AACA;AACA,GAAG,WAAW;AACd,GAAG;AACH,MAAM,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;AAChC;;AAEA;AACA;AACA;AACA,GAAG,WAAW;AACd,GAAG;AACH,MAAM,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;AAChC;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,KAAK,CAAC,KAAK;AACd,GAAG;AACH,MAAM,MAAM,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC,GAAG;;AAEhE,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AAC/B,MAAM;AACN,SAAS,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AAClC,SAAS;AACT,YAAY,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC;AACpC,YAAY,IAAI,CAAC,kBAAkB,EAAE;AACrC;;AAEA,SAAS,IAAI,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,EAAE,KAAK,CAAC,cAAc,EAAE,CAAC;AACpE,SAAS,IAAI,IAAI,CAAC,QAAQ,CAAC,eAAe,EAAE,EAAE,KAAK,CAAC,eAAe,EAAE,CAAC;AACtE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,SAAS,CAAC,GAAG;AAChB,GAAG;AACH,MAAM,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC;;AAEnF,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AAC/B,MAAM;AACN,SAAS,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC;;AAEjC,SAAS,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC;AAClC,SAAS;AACT,YAAY,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC;AACpC,YAAY,IAAI,CAAC,kBAAkB,EAAE;AACrC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,UAAU,CAAC,OAAO;AACrB,GAAG;AACH,MAAM,IAAI,OAAO,OAAO,EAAE,cAAc,KAAK,SAAS,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,OAAO,CAAC,cAAc,CAAC;AAChH,MAAM,IAAI,OAAO,OAAO,EAAE,OAAO,KAAK,SAAS,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;AAC3F,MAAM,IAAI,OAAO,OAAO,EAAE,eAAe,KAAK,SAAS,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAe,GAAG,OAAO,CAAC,eAAe,CAAC;AACnH;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,KAAK,CAAC,GAAG;AACZ,GAAG;AACH,MAAM,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC;AAC1C;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,SAAS,CAAC,OAAO;AACpB,GAAG;AACH,MAAM,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;;AAExC,MAAM,OAAO,CAAC,IAAI,CAAC,CAAC;;AAEpB;AACA,MAAM,OAAO;AACb,MAAM;AACN,SAAS,MAAM,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,GAAG,KAAK,GAAG,KAAK,OAAO,CAAC;AAC9E,SAAS,IAAI,KAAK,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;AAChE,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG,kBAAkB;AACrB,GAAG;AACH,MAAM,KAAK,IAAI,IAAI,GAAG,CAAC,EAAE,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC;AACtG;AACA;;;;","x_google_ignoreList":[0]}